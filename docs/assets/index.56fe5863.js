var t=Object.defineProperty,e=Object.defineProperties,i=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,h=(t,e)=>{for(var i in e||(e={}))s.call(e,i)&&a(t,i,e[i]);if(n)for(var i of n(e))o.call(e,i)&&a(t,i,e[i]);return t},r=(t,n)=>e(t,i(n));import{i as d}from"./vendor.eb7aeca8.js";const p={arena:{width:200,height:600,lanes:2},car:{width:40,height:60},opponent:{gap:300,step:3,color:"#f0f003"},mycar:{step:10,color:"#00f0f0"},divider:{width:10,height:40,gap:50,step:1}},c=new d.GUI({preset:"thegame"});let g;c.open();const m=()=>{g&&g()},l=c.addFolder("game");l.add(p.arena,"width").min(100).max(600).onFinishChange(m),l.add(p.arena,"height").min(100).max(1e3).onFinishChange(m),l.add(p.arena,"lanes").min(2).max(10).step(1).onFinishChange(m);const f=c.addFolder("dividers");f.add(p.divider,"width").min(1).max(100).onFinishChange(m),f.add(p.divider,"height").min(1).max(100).onFinishChange(m),f.add(p.divider,"gap").min(1).max(100).onFinishChange(m);const y=c.addFolder("cars");y.add(p.car,"width").min(1).max(200).onFinishChange(m),y.add(p.car,"height").min(1).max(200).onFinishChange(m);const u=c.addFolder("opponent");u.add(p.opponent,"gap").min(1).max(200).onFinishChange(m),u.addColor(p.opponent,"color").onFinishChange(m);c.addFolder("mycar").addColor(p.mycar,"color").onFinishChange(m);const x=c.addFolder("speed");x.add(p.divider,"step").name("Dividers").min(1).max(20).onFinishChange(m),x.add(p.opponent,"step").name("Opponent").min(1).max(20).onFinishChange(m),x.add(p.mycar,"step").name("My Car").min(1).max(200).onFinishChange(m);let w=0;class v{constructor({gap:t,step:e,height:i,onAdd:n,onRemove:s,onReuse:o}){this.items=[],this.onAdd=null!=n?n:t=>t,this.onRemove=null!=s?s:()=>{},this.onReuse=null!=o?o:()=>{},this.setConfig({gap:t,step:e,height:i}),this.addItem({y:-t}),this.addItem({y:-2*t})}setConfig({gap:t,step:e,height:i}){this.config={gap:t,height:i,step:e}}addItem({y:t}){const e={y:t,id:w++};return this.onAdd(e.id),this.items.unshift(e),e}getItems(){return this.items}tick(){const{gap:t,height:e,step:i}=this.config;this.items=this.items.map((t=>r(h({},t),{y:t.y+i})));const n=this.items[this.items.length-2];if(!n)throw new Error("Second last not found.");if(n.y>e){const e=this.items.pop();if(!e)throw new Error("Last not found!");const i=this.items[0];i.y>0?(this.items.unshift(e),e.y=i.y-t,this.onReuse(e.id)):this.onRemove(e.id)}const s=this.items[0];if(!s)throw new Error("First item not found.");s.y>0&&this.addItem({y:s.y-t})}}const C=document.querySelector("#app");let b={};g=()=>{Object.entries(b).forEach((([t,e])=>{e&&e.remove(),delete b[t]}))};const F=new class{constructor(t){this.config=t;const{divider:e}=this.config;this.stream=new v({gap:e.gap,step:e.step,height:t.arena.height})}setConfig(t){this.config=t;const{divider:e}=this.config;this.stream.setConfig({gap:e.gap,height:this.config.arena.height,step:e.step})}tick(){this.stream.tick()}getItems(){const{arena:t,divider:e}=this.config;return this.stream.getItems().flatMap((i=>{let n=[];for(let s=1;s<this.config.arena.lanes;s++)n.push(r(h({},i),{id:`${i.id}-${s}`,x:t.width/t.lanes*s-e.width/2}));return n}))}}(p),I=new class{constructor(t){this.opponentMap={},this.onAdd=t=>{const e=Math.round(Math.random()*(this.config.arena.lanes-1));this.opponentMap[t]={position:e}},this.remove=t=>{delete this.opponentMap[t]},this.config=t,this.stream=new v({gap:t.opponent.gap,height:t.arena.height,step:t.opponent.step,onAdd:this.onAdd,onReuse:this.onAdd,onRemove:this.remove})}setConfig(t){this.config=t,this.stream.setConfig({gap:t.opponent.gap,height:t.arena.height,step:t.opponent.step})}getOpponents(){const{arena:t}=this.config;return this.stream.getItems().map((({id:e,y:i})=>{const{position:n}=this.opponentMap[e];return{id:e,y:i,x:(2*n+1)*(t.width/(2*t.lanes))}}))}tick(){this.stream.tick()}}(p),$=new class{constructor(t){this.positionIndex=0,this.config=t,this.x=0,this.y=t.arena.height-t.car.height-20}setConfig(t){this.config=t,this.y=t.arena.height-t.car.height-20}moveLeft(){this.positionIndex=Math.max(0,this.positionIndex-1)}moveRight(){this.positionIndex=Math.min(this.config.arena.lanes-1,this.positionIndex+1)}getDimensions(){return{x:this.x,y:this.y}}tick(){const t=this.config.arena.width*(2*this.positionIndex+1)/(2*this.config.arena.lanes)-this.x,e=0!==t?t/Math.abs(t)*this.config.mycar.step:0;this.x+=Math.abs(e)>Math.abs(t)?t:e}}(p),k=document.createElement("div");k.style.position="absolute",C.append(k);const E=()=>{C.style.width=`${p.arena.width}px`,C.style.height=`${p.arena.height}px`,F.setConfig(p),F.tick(),F.getItems().forEach((({id:t,y:e,x:i})=>{const{height:n,width:s}=p.divider;let o=b[t];if(!o){const e=document.createElement("div");o=(t=>{let e=null!=t?t:document.createElement("div");return e.style.position="absolute",e.style.backgroundColor="white",e})(e),b[t]=e,C.append(o)}o.style.transform=`translate(${i}px, ${e}px)`,o.style.width=`${s}px`,o.style.height=`${n}px`})),I.setConfig(p),I.tick(),I.getOpponents().forEach((({id:t,x:e,y:i})=>{const{height:n,width:s}=p.car;let o=b[t];if(!o){const e=document.createElement("div");o=(t=>{let e=null!=t?t:document.createElement("div");return e.style.position="absolute",e})(e),b[t]=e,C.append(o)}o.style.backgroundColor=p.opponent.color,o.style.transform=`translate(${e-s/2}px, ${i}px)`,o.style.width=`${s}px`,o.style.height=`${n}px`})),$.setConfig(p),$.tick();const{x:t,y:e}=$.getDimensions();k.style.width=`${p.car.width}px`,k.style.height=`${p.car.height}px`,k.style.backgroundColor=p.mycar.color,k.style.transform=`translate(${t-p.car.width/2}px, ${e}px)`,requestAnimationFrame(E)};window.addEventListener("keydown",(t=>{switch(t.key){case"ArrowLeft":$.moveLeft();break;case"ArrowRight":$.moveRight()}})),E();
