var t=Object.defineProperty,e=Object.defineProperties,i=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,a=(e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n,r=(t,e)=>{for(var i in e||(e={}))s.call(e,i)&&a(t,i,e[i]);if(n)for(var i of n(e))o.call(e,i)&&a(t,i,e[i]);return t},h=(t,n)=>e(t,i(n));import{i as d}from"./vendor.eb7aeca8.js";const p={arena:{width:200,height:600,lanes:10},car:{width:10,height:25},opponent:{gap:300,step:3,color:"#f0f003"},mycar:{step:5,color:"#00f0f0"},divider:{width:2,height:30,gap:50,step:1}},c=new d.GUI({preset:"thegame"});let m;c.close();const g=()=>{m&&m()},l=c.addFolder("game");l.add(p.arena,"width").min(100).max(600).onFinishChange(g),l.add(p.arena,"height").min(100).max(1e3).onFinishChange(g),l.add(p.arena,"lanes").min(2).max(10).step(1).onFinishChange(g);const f=c.addFolder("dividers");f.add(p.divider,"width").min(1).max(100).onFinishChange(g),f.add(p.divider,"height").min(1).max(100).onFinishChange(g),f.add(p.divider,"gap").min(1).max(100).onFinishChange(g),f.add(p.divider,"step").min(1).max(100).onFinishChange(g);const u=c.addFolder("cars");u.add(p.car,"width").min(1).max(200).onFinishChange(g),u.add(p.car,"height").min(1).max(200).onFinishChange(g);const v=c.addFolder("opponent");v.add(p.opponent,"gap").min(1).max(200).onFinishChange(g),v.addColor(p.opponent,"color").onFinishChange(g);c.addFolder("mycar").addColor(p.mycar,"color").onFinishChange(g);const y=c.addFolder("speed");y.add(p.divider,"step").name("Dividers").min(1).max(20).onFinishChange(g),y.add(p.opponent,"step").name("Opponent").min(1).max(20).onFinishChange(g),y.add(p.mycar,"step").name("My Car").min(1).max(200).onFinishChange(g);let w=0;class C{constructor({config:t,onAdd:e,onRemove:i}){this.items=[],this.onAdd=e,this.onRemove=i,this.setConfig(t)}setConfig({gap:t,step:e,length:i}){this.config={gap:t,length:i,step:e}}getItems(){return this.items}tick(){const{step:t}=this.config;this.items=this.items.map((e=>h(r({},e),{pos:e.pos+t}))),this.removeEndItemIfOutside(),this.prependItemIfPossible()}removeEndItemIfOutside(){const t=this.items[this.items.length-2];t&&this.isBeyondLength(t)&&this.removeEndItem()}removeEndItem(){var t;const e=this.items.pop();e&&(null==(t=this.onRemove)||t.call(this,e.id))}prependItemIfPossible(){const{gap:t}=this.config,e=this.items[0];e?e.pos>0&&this.prependItem(this.newItem(e.pos-t)):this.prependItem(this.newItem(-t))}prependItem(t){var e;return null==(e=this.onAdd)||e.call(this,t.id),this.items.unshift(t),t}newItem(t){return{pos:t,id:w++}}isBeyondLength({pos:t}){const{length:e}=this.config;return t>e}}class x{constructor(t){this.stream=new C({config:this.transformConfig(t)})}tick(){this.stream.tick()}getState(){return this.stream.getItems().map((t=>{var e=t,{pos:i}=e,a=((t,e)=>{var i={};for(var a in t)s.call(t,a)&&e.indexOf(a)<0&&(i[a]=t[a]);if(null!=t&&n)for(var a of n(t))e.indexOf(a)<0&&o.call(t,a)&&(i[a]=t[a]);return i})(e,["pos"]);return h(r({},a),{posY:i})}))}setConfig(t){this.stream.setConfig(this.transformConfig(t))}transformConfig(t){const{divider:{gap:e,step:i}}=t;return{gap:e,length:t.arena.height,step:i}}}class I{constructor(t){this.laneIndex=0,this.x=0,this.config=this.transformConfig(t)}setConfig(t){this.config=this.transformConfig(t)}transformConfig(t){return{height:t.arena.height,width:t.arena.width,lanes:t.arena.lanes,step:t.mycar.step}}tick(){const t=this.getPosXOfLane(this.laneIndex);if(t!==this.x){const e=this.x;this.x+=Math.sign(t-this.x)*this.config.step,Math.sign(t-e)!==Math.sign(t-this.x)&&(this.x=t)}}getPosXOfLane(t){const e=this.config.width/this.config.lanes;return e*(t+1)-e/2}moveLeft(){this.laneIndex=Math.max(0,this.laneIndex-1)}moveRight(){this.laneIndex=Math.min(this.config.lanes-1,this.laneIndex+1)}getState(){return{laneIndex:this.laneIndex,posX:this.x}}}class E{constructor(t){this.opponentMap={},this.onAdd=t=>{const e=Math.round(Math.random()*(this.config.lanes-1));let i=[];for(let n=0;n<this.config.lanes;n++)n!==e&&i.push({laneIndex:n,dY:0});this.opponentMap[t]=i},this.onRemove=t=>{delete this.opponentMap[t]},this.config=this.transformConfig(t),this.stream=new C({config:this.config,onAdd:this.onAdd,onRemove:this.onRemove})}setConfig(t){this.config=this.transformConfig(t),this.stream.setConfig(this.config)}transformConfig(t){const{opponent:{gap:e,step:i},arena:{height:n,lanes:s}}=t;return{gap:e,lanes:s,length:n,step:i}}getState(){return this.stream.getItems().map((({id:t,pos:e})=>({id:t,opponents:this.opponentMap[t].map((t=>h(r({},t),{posY:e+t.dY})))})))}tick(){this.stream.tick()}}class F{constructor(t){this.config=t,this.dividers=new x(this.config),this.mycar=new I(this.config),this.opponents=new E(this.config)}setConfig(t){this.config=t,this.dividers.setConfig(t),this.mycar.setConfig(t),this.opponents.setConfig(t)}tick(){this.dividers.tick(),this.opponents.tick(),this.mycar.tick()}getState(){return{mycar:this.mycar.getState(),opponents:this.opponents.getState(),dividers:this.dividers.getState()}}moveLeft(){this.mycar.moveLeft()}moveRight(){this.mycar.moveRight()}}class k{constructor({key:t="item",wrapperID:e,initialItems:i=[],onAdd:n,onBeforeUnmount:s,onUpdate:o}){this.key=t,this.items=i,this.wrapper=document.createElement("div"),this.wrapper.id=e,this.onAdd=n,this.onBeforeUnmount=s,this.onUpdate=o}getId(t){return`${this.key}:${t}`}getWrapper(){return this.wrapper}update(t){const{added:e,removed:i}=((t,e)=>{const i=new Set(t.map((t=>t.id))),n=new Set(e.map((t=>t.id))),s=t.filter((t=>!n.has(t.id)));return{added:e.filter((t=>!i.has(t.id))),removed:s}})(this.items,t);e.forEach((t=>{var e;const i=document.createElement("div");i.id=`${this.key}:${t.id}`,this.wrapper.append(i),null==(e=this.onAdd)||e.call(this,i,t)})),t.forEach((t=>{var e;const i=document.getElementById(this.getId(t.id));i instanceof HTMLDivElement&&(null==(e=this.onUpdate)||e.call(this,i,t))})),i.forEach((t=>{var e;const i=document.getElementById(this.getId(t.id));i instanceof HTMLDivElement&&(null==(e=this.onBeforeUnmount)||e.call(this,i,t),i.remove())})),this.items=t}}class O{constructor(t){this.setConfig(t),this.ui=new k({key:"divider",wrapperID:"dividers",onAdd:t=>{for(let e=0;e<this.config.arena.lanes-1;e++){const e=document.createElement("div");e.classList.add("divider"),t.append(e)}},onUpdate:(t,e)=>{t.querySelectorAll("div").forEach(((t,i)=>{t.style.transform=`translateY(${e.posY}px)`;const n=Math.round(this.config.arena.width/this.config.arena.lanes*(i+1)-this.config.divider.width/2);parseInt(t.style.left,10)!==n&&(t.style.left=`${n}px`),t.style.opacity=i+1>=this.config.arena.lanes?"0":"1"}))}})}getWrapper(){return this.ui.getWrapper()}setConfig(t){this.config=t,document.documentElement.style.setProperty("--divider-width",`${this.config.divider.width}px`),document.documentElement.style.setProperty("--divider-height",`${this.config.divider.height}px`)}updateState(t){this.ui.update(t.dividers)}}class M{constructor(t){this.ui=document.createElement("div"),this.ui.classList.add("mycar"),this.setConfig(t),this.ui.style.bottom="20px",this.ui.style.top="auto"}getDOM(){return this.ui}setConfig(t){this.config=t,this.ui.style.width=t.car.width+"px",this.ui.style.height=t.car.height+"px"}render(t){this.ui.style.left=t.mycar.posX-this.config.car.width/2+"px"}}class b{constructor(t){this.setConfig(t),this.ui=new k({key:"opponent",wrapperID:"opponents",onAdd:t=>{for(let e=0;e<this.config.arena.lanes-1;e++){const e=document.createElement("div");e.classList.add("opponent"),t.append(e)}},onUpdate:(t,e)=>{t.querySelectorAll("div").forEach(((t,i)=>{const n=this.config.arena.width/this.config.arena.lanes,s=e.opponents[i];s&&(t.style.transform=`translate(${n*s.laneIndex-this.config.car.width/2+n/2}px, ${s.posY}px)`)}))}})}getWrapper(){return this.ui.getWrapper()}setConfig(t){this.config=t,document.documentElement.style.setProperty("--opponent-width",`${this.config.car.width}px`),document.documentElement.style.setProperty("--opponent-height",`${this.config.car.height}px`)}updateState(t){this.ui.update(t.opponents)}}class S{constructor(t){this.uiWrapper=document.createElement("div"),this.uiWrapper.classList.add("game"),this.mycar=new M(t),this.dividers=new O(t),this.opponents=new b(t),this.uiWrapper.append(this.mycar.getDOM()),this.uiWrapper.append(this.dividers.getWrapper()),this.uiWrapper.append(this.opponents.getWrapper()),this.setConfig(t)}getDOM(){return this.uiWrapper}setConfig(t){this.uiWrapper.style.width=t.arena.width+"px",this.uiWrapper.style.height=t.arena.height+"px",this.mycar.setConfig(t),this.dividers.setConfig(t),this.opponents.setConfig(t)}render(t){this.mycar.render(t),this.dividers.updateState(t),this.opponents.updateState(t)}}!function(){const t=new F(p),e=new S(p);m=()=>{t.setConfig(p),e.setConfig(p)},window.addEventListener("keydown",(e=>{switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight()}})),document.body.append(e.getDOM()),function i(){t.tick(),e.render(t.getState()),requestAnimationFrame(i)}()}();
